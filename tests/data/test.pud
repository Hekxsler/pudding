import 'import_me'
from 'me2' import 'string'

define nows /\S+/
define quote /\"/
define word /[\w-]+/
define enqueue_test /enqueue test[\r\n]+/

grammar dict(default):
    skip ','
    match word ws '=' ws quote string quote:
        out.add_attribute('.', '$0', '$5')
    match '}':
        do.return()

grammar list(default):
    match ',':
        do.next()
    match quote string quote:
        out.create('item', '$1')
    match '{':
        out.open('item')
        dict()
    match ']':
        do.return()

grammar section(default):
    match word ws '=' ws quote string quote nl:
        out.add('$0', '$5')
    match word ws '=' ws '[':
        out.open('$0')
        list()

grammar enqueue_test(default):
    match 'start' nl:
        out.add('$0')
    match 'end' nl:
        do.return()

grammar input(default):
    match '[' word ']' nl:
        out.enter('$1')
        section()
    match '[' word '.' word ']' nl:
        out.enter('$1/$3')
        section()
    match enqueue_test:
        out.enqueue_before(/before/, 'before', 'test')
        out.enqueue_after(/after/, 'after', 'test')
        out.enqueue_on_add(/onadd/, 'onadd', 'value')
        out.enter('enqueue?name="test"')
        enqueue_test()
        out.clear_queue()
    out.set_root_name('test')
