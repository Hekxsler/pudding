import 'import_me'
from 'me2' import 'string'
from 'me2' import 'enqueue_test'

from 'test' import 'section'

define nows /\S+/
define quote /\"/
define word /[\w-]+/
define enqueue_test /enqueue test[\r\n]+/


grammar list(default):
    skip ','
    match quote string quote:
        out.create('item', '$1')
    match '{' word ws '=' ws quote string quote ', ' word ws '=' ws quote string quote '}':
        out.add('item?$1="$6"&$9="$14"')
    match ']':
        do.return()

grammar input(default):
    imatch '[' /[A-Z]+/ ']' nl:
        out.enter('$1')
        section()
    match '[' word '.' word ']' nl:
        out.enter('$1/$3')
        section()
    when enqueue_test:
        out.enqueue_before(/(before) (this)/, '$0', '$1')
        out.enqueue_after(/(after) (that)/, '$0', '$1')
        out.enqueue_on_add(/(onadd)/, '$0')
        do.next()
    match enqueue_test:
        out.enter('enqueue?name="test"')
        enqueue_test()
        out.clear_queue()
    skip 'add_attribute' ws word '=' word ' to ' word
    skip 'replace text of' ws word ws word ws word
    skip 'remove_tag' ws word ' from ' word ' with attribute ' word '=' word
